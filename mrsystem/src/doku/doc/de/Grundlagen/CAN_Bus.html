<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head>
<meta content="text/html;charset=UTF-8" http-equiv="Content-Type"><title>CAN Anschluss</title>
<meta content="2009-09-23" name="date">
<link title="Style" href="../../stylesheet.css" type="text/css" rel="stylesheet">
<script type="text/javascript">
function windowTitle() {
if (location.href.indexOf('is-external=true') == -1) { parent.document.title="CAN Anschluss"; } }
</script></head>
<body onload="windowTitle();" style="background-color: white;">
<table style="width: 100%;" summary="" border="0" cellpadding="1" cellspacing="0">
<tbody>
<tr>
<td colspan="2" class="NavBarCell1" bgcolor="#eeeeff">
<table summary="" border="0" cellpadding="0" cellspacing="3">
<tbody>
<tr align="center" valign="top">
<td class="NavBarCell1" bgcolor="#eeeeff">
<a href="../../overview-summary.html"><font class="NavBarFont1"><b>Übersicht</b></font></a>&nbsp;</td>
<td class="NavBarCell1" bgcolor="#eeeeff">
<a href="../../help-doc.html"><font class="NavBarFont1"><b>Help</b></font></a>&nbsp;</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr>
<td style="background-color: white; text-align: right; vertical-align: middle;" class="NavBarCell2"><font size="-2"> <a href="../../index.html" target="_top"><b>FRAMES</b></a>
&nbsp;
&nbsp;<a href="CAN_Bus.html" target="_top"><b>NO
FRAMES</b></a> &nbsp;
&nbsp;
<script type="text/javascript">
<!--
if(window==top) {
document.writeln('<A HREF="../../allclasses-noframe.html"><B>All Classes</B></A>');
}
//-->
</script>
<noscript> <A HREF="../../allclasses-noframe.html"><B>All Classes</B></A>
</noscript>
</font></td>
</tr>
</tbody>
</table>
<hr>
<h2>CAN Anschluss</h2>
<hr>
<table summary="" border="1" cellpadding="3" cellspacing="0" width="100%">
<tbody>
<tr class="TableHeadingColor" bgcolor="#ccccff">
<th colspan="2" align="left"><font size="+2">
<b>Allgemeines</b></font></th>
</tr>
</tbody>
</table>
<p>Der CAN Bus dient als Kommunikationsnetz der Steuergeräte bei Märklin
Systems. Ziel ist, allen Geräten zur Steuerung einer Modellbahnanlage
ein einheitliches Kommunikationsmedium zur Verfügung zu stellen.<br>
<br>
Mittels CAN Meldungen werden Steueraufgaben übermittelt.<br>
<br>
Mittels CAN Streams werden Updates und Konfigurationsdaten übertragen. <br>
<br>
Die Datenrate ist 250 KBit/s, die maximale Buslänge ist 100m.
</p>
<p>
<table summary="" border="1" cellpadding="3" cellspacing="0" width="100%">
<tbody>
<tr class="TableHeadingColor" bgcolor="#ccccff">
<th colspan="1" align="left"><font size="+2">
<b>CAN Grundformat</b></font></th>
</tr>
</tbody>
</table>
<p>
Das CAN Protokoll schreibt vor, dass Meldungen aus einer 29 Bit
Meldungskennung, 4 Bit Meldungslänge sowie bis zu 8 Datenbyte bestehen.
<br>
Die Meldungskennung wird aufgeteilt in die Unterbereiche Priorität
(Prio), Kommando (Command), Antwortbit (Response) und Hash. Die Kommunikation
basiert dabei auf folgendem Datenformat:
</p>
<table style="text-align: center; width: 750px;" class="CanTable" border="1" bordercolor="#000000" cellspacing="1">
<tbody>
<tr valign="top">
<td colspan="4">Meldungskennung</td>
<td>DLC</td>
<td>Byte 0</td>
<td>Byte 1</td>
<td>Byte 2</td>
<td>Byte 3</td>
<td>Byte 4</td>
<td>Byte 5</td>
<td>Byte 6</td>
<td>Byte 7</td>
</tr>

<tr valign="top">
<td>Prio</td>
<td>Command</td>
<td>Resp.</td>
<td>Hash</td>
<td>DLC</td>
<td>D-Byte 0</td>
<td>D-Byte 1</td>
<td>D-Byte 2</td>
<td>D-Byte 3</td>
<td>D-Byte 4</td>
<td>D-Byte 5</td>
<td>D-Byte 6</td>
<td>D-Byte 7</td>
</tr>
<tr valign="top">
<td>2+2 Bit</td>
<td>8 Bit</td>
<td>1 Bit</td>
<td>16 Bit</td>
<td>4 Bit</td>
<td>8 Bit</td>
<td>8 Bit</td>
<td>8 Bit</td>
<td>8 Bit</td>
<td>8 Bit</td>
<td>8 Bit</td>
<td>8 Bit</td>
<td>8 Bit</td>
</tr>
<tr valign="top">
<td>XX + XX</td>
<td>XXXXXXX</td>
<td>X</td>
<td>XXXXXXXXXXXXXXX</td>
<td>XXXX</td>
<td>XXXXXXXX</td>
<td>XXXXXXXX</td>
<td>XXXXXXXX</td>
<td>XXXXXXXX</td>
<td>XXXXXXXX</td>
<td>XXXXXXXX</td>
<td>XXXXXXXX</td>
<td>XXXXXXXX</td>
</tr>
<tr valign="top">
<td>Message Prio</td>
<td>Kommando Kennzeichnung</td>
<td>CMD/&nbsp;Resp.</td>
<td>Kollisions-auflösung</td>
<td>Anzahl Daten-bytes</td>
<td>Daten</td>
<td>....</td>
<td><br></td>
<td><br></td>
<td><br></td>
<td><br></td>
<td><br></td>
<td><br></td>
</tr>
</tbody>
</table></p><p>
<table summary="" border="1" cellpadding="3" cellspacing="0" width="100%">
<tbody>
<tr class="TableHeadingColor" bgcolor="#ccccff">
<th colspan="1" align="left"><font size="+2">
<b>Grundbeschreibung der Felder</b></font></th>
</tr></tbody></table>
<h3>Priorität (Prio) </h3>
<p style="margin-left: 40px;" ="">Bestimmt die Priorisierung der Meldung auf dem CAN Bus:</p>
<p style="margin-left: 40px;" ="">
Prio 1: Stopp / Go / Kurzschluss-Meldung<br>
Prio 2: Rückmeldungen<br>
Prio 3: Lok anhalten(?)<br>
Prio 4: Lok / Zubehörbefehle<br>
Rest Frei</p>
<p style="margin-left: 40px;" ="">Die Priorisierung wird von den Teilnehmern nicht als Teil der Meldung verstanden, sondern dient nur zum
Priorisieren der Meldung auf dem CAN Bus.</p>
<h3>Kommando</h3>
<p style="margin-left: 40px;">Bestimmt das vom Endgerät auszuführende, bzw. das ausgeführte Kommando.</p>
<p style="margin-left: 40px;">Kommandowerte sind eindeutig definiert.</p>
<p style="margin-left: 40px;">Kennwertbereiche für die Kommandowerte:</p>
<table style="margin-left: 40px;" border="1" bordercolor="#000000" cellpadding="3" cellspacing="0">
<tbody><tr valign="top">
<td>Bereich</td>
<td>Anzahl</td>
<td>Start</td>
<td>Ende</td>
</tr>
<tr valign="top">
<td>Systembefehle</td>
<td>1</td>
<td>0x00</td>
<td>0x00</td>
</tr><tr valign="top">
<td>Verwaltung</td>
<td>8</td>
<td>0x01</td>
<td>0x0A</td>
</tr><tr valign="top">
<td>Zubehör</td>
<td>2</td>
<td>0x0B</td>
<td>0x0D</td>
</tr><tr valign="top">
<td>Rückmeldungen</td>
<td>3</td>
<td>0x10</td>
<td>0x12</td>
</tr><tr valign="top">
<td>Software Update / Konfig</td>
<td>6</td>
<td>0x18</td>
<td>0x1C</td>
</tr><tr valign="top">
<td>GUI Informationsübertragung</td>
<td>3</td>
<td>0x80</td>
<td> </td>
</tr></tbody></table>
<p></p><h3>Response</h3>
<p style="margin-left: 40px;">Bestimmt, ob die CAN Meldung eine
Anforderung oder eine Antwort auf eine vorhergehende Anforderung ist.
Grundsätzlich wird eine Anforderung ohne ein gesetztes Response Bit
gesendet. Sobald ein Kommando ausgeführt wurde, wird es mit
gesetztem Response Bitzurückgesendet. Dabei wird der ursprünglichen Meldungsinhalt in der Antwort um eventuell
angefragte Werte ergänzt. Jeder Teilnehmer am Bus der die Meldung ausgeführt hat bestätigt das Kommando.</p>
<h3>Hash</h3>
<p style="margin-left: 40px;">Der Hash erfüllt eine Doppelfunktion:</p>
<p style="margin-left: 40px;">Primär dient er zur Kollisionsauflösung der Meldungen und zur Sicherstellung der Kollisionsfreiheit zum CS1 Protokoll. </p>
<p style="margin-left: 40px;">Sekundär kann er die Folgenummer einer Datenübertragung beinhalten.</p>
<p style="margin-left: 40px;">Kollisionsfreiheit zum CS1 Protokoll: </p>
<p style="margin-left: 40px;">Im CAN Protokoll der CS1 wird der Wert 6 für den "com-Bereich der ID", dies sind die Bits 7..9, d.h. Highest Bit im Lowest-Byte (0b0xxxxxxx) und die beiden Bits
darüber (0bxxxxxx11), nicht benutzt. Diese Bitkombination wird daher zur Unterscheidung fest im Hash verwendet.</p>
<p style="margin-left: 40px;"><img style="width: 366px; height: 100px;" alt="Dastellung Hash Systematik" src="../../resources/AdressSystemtic.gif"></p>
<p style="margin-left: 40px;">Kollisionsauflösung:</p>
<p style="margin-left: 40px;">Der Hash dient dazu, die CAN Meldungen mit hoher Wahrscheinlichkeit kollisionsfrei zu gestalten. Dieser 16
Bit Wert wird gebildet aus der UID Hash. Berechnung: 16 Bit High UID XOR 16 Bit Low der UID. Danach werden die Bits entsprechend zur CS1
Unterscheidung gesetzt.</p>
<p style="margin-left: 40px;">Jeder Teilnehmer am Bus hat den Hash
empfangener CAN-Meldungen auf Kollisionsfreiheit zu pr�fen. Wird der
eigene Hash empfangen, so ist ein neuer zu w�hlen. Dieser darf
mit keinem weiteren empfangenen �bereinstimmen.</p>
<p style="margin-left: 40px;">Folgenummer einer
Daten�bertragung:</p>
<p style="margin-left: 40px;">Wird der Hash zur
Kennzeichnung der
Paketnummer verwendet, so werden diese Bits bei der Berechnung der
Paketnummer ausgeblendet. D.H. bei der 16 Bit Zahl werden die Bits 7
bis 9 ausgeblendet, die obersten 3 Bits sind 0. </p>
<p style="margin-left: 40px;">Der Wertebereich verringert
sich
entsprechend auf 8192.</p>
<h3>Meldungsbest�tigung</h3>
<p style="margin-left: 40px;">Eine Initiator eine Meldung
muss Sorge
daf�r tragen, dass die gew�nschte Aktion tats�chlich ausgef�hrt
wird. Die Meldungen werden nicht gesichert �ber den CAN-Bus
�bertragen. Der Empfang einer Meldung wird nicht best�tigt. Die
Ausf�hrung eines Kommandos wird best�tigt, bzw nur durch das Senden
der Best�tigungsmeldung quittiert. Fehlt diese Quittierung, ist
davon auszugehen, dass die Aktion nicht ausgef�hrt wurde. </p>
<h3>Sonstiges</h3>
<p style="margin-left: 40px;">In der Kommunikation
werden keine Sender + Empf�nger Adresse verwendet.</p>
<p style="margin-left: 40px;">In der Kommunikation werden
keine Remoteframes (=CAN-ID
anfragen statt mit Daten senden) verwendet. Im allgemeinen sind die
Teilnehmer so konfiguriert, dass diese nicht empfangen werden.</p>
<p style="margin-left: 40px;">Byte-Order in den Meldungen
ist immer Motorola Big Endian.</p>
<br></p><p>
<table border="1" cellpadding="3" cellspacing="0" width="100%">
<tbody>
<tr class="TableHeadingColor" bgcolor="#ccccff">
<th colspan="1" align="left"><font size="+2">
�bertragung der CAN Kommandos via Ethernet</font></th>
</tr>
</tbody>
</table>
<p>Auf der CS2 kann - �ber das Setup / IP - Einstellungen - das
Can-UDP-Gateway gestartet werden. Dort kann eine IP-Adresse (auch
Broadcast) spezifiziert werden, an die das Gateway sendet. Die
Portadressen sind �ber die Oberfl�che nicht einstellbar und werden fest
auf die Ports 15731 und 15730 gesetzt.</p>
<p>Funktionsweise:
</p>
<p>Wenn gestartet, lauscht das Gateway auf dem Ethernet
Empfangsport 15731. Es verwirft alle UDP-Pakete, die eine L�nge
ungleich 13 haben. Pakete der L�nge 13 werden als Can-Bus-Pakete
interpretiert: 4 Byte Can-Bus-Id (BigEndian oder Network-Order), 1 Byte
L�nge und 8 Byte Daten, die ggf. mit Nullbytes aufzuf�llen sind. Dieses
Paket wird dann als Can-Bus-Botschaft auf den Can-Bus gegeben. Nicht
abbildbare Bits oder Bytes auf dem CAN-Bus werden nicht beachtet und
sollten auf "0" gesetzt werden.<br>
</p>
<p>Umgekehrt liest das Gateway alle Can-Bus-Botschaften, wandelt
sie in analoger Weise in UDP-Pakete der L�nge 13 um und verschickt
diese an die spezifizierte IP-Adresse und den Sendeport (15730). <br>
</p>
<p>Beispielkonfiguration im lokalen Netz mit dem Netzwerksegment
192.168.2.0 <br>
</p>
<p style="margin-left: 40px;">CS2: (192.168.2.20)
empf�ngt auf Port 15731, sendet an die Broadcast-Adresse
192.168.2.255:15730. <br>
PC1: (192.168.2.10) empf�ngt auf Port 15730 sendet an CS2
(192.168.2.20:15731) <br>
PC2: (192.168.2.11) empf�ngt auf Port 15730 sendet an CS2
(192.168.2.20:15731)<br>
</p>
<p>Im Ethernet werden immer Pakete mit 13 Bytes �bertragen,
unabh�ngig von der CAN - Datagramgr��e, da das CAN - Ethernet - Gateway
Pakete anderer L�nge verwirft.</p>
<p>Die Bytes in der CAN- Botschaft werden folgenderma�en in dem
UDP-Paket eingepackt:<br>
</p>
<p style="margin-left: 40px;">Bytes 1 bis 4 sind die
Meldungskennung. <br>
Byte 5 entspricht dem DLC der CAN-Meldung.<br>
Bytes 6 - 13 sind die entsprechenden Nutzdaten. Dabei nicht ben�tigte
Bytes sind mit 00 zu f�llen.</p>
<table summary="" border="1" cellpadding="3" cellspacing="0" width="100%">
<tbody>
<tr class="TableHeadingColor" bgcolor="#ccccff">
<th colspan="1" align="left"><font size="+2">
Allgemeines</font></th>
</tr>
</tbody>
</table>
<p style="font-weight: bold;">Adressen im System</p>
<p style="margin-left: 40px;">Der gesamte Adressraum hat
2**32 Adressen (0x0000 0000 - 0xFFFF FFFF), dieses sind rund 4
Milliarden Adressen. Diese werden auch als UID (Universal Identifyer)
bezeichnet. Je nach eingesetztem Protokoll hat jedoch eine UID eine
andere Bedeutung.<br>
</p>
<p style="font-weight: bold;">Definition der
Teilnehmerkennungen<br>
</p>
<p style="margin-left: 40px;">Im System besitzt jeder
adressierbare Teilnehmer eine eindeutige 32 Bit Adresse. <br>
Dabei werden folgende UID unterschieden:<br>
Ger�te UID&nbsp;&nbsp;&nbsp; Eindeutig vergebene Universal
ID.<br>
Loc ID&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
(=Local ID, nicht Locomotive ID) Aus dem Protokoll und der Adresse
berechnete Lokale ID.<br>
MFX UID&nbsp;&nbsp;&nbsp; MFX Universal UID.<br>
Bestimmte Ger�te - UID besitzen eine besondere Bedeutung:<br>
Die UID 0x00000000 ist die Broadcastadresse. Signalisiert, dass mehrere
Teilnehmer denselben Befehl abarbeiten sollen.<br>
Die UID 0xFFFFFFFF ist ung�ltig und steht f�r eine nicht initialisierte
UID des Endger�tes.<br>
</p>
<p style="font-weight: bold;">Einbindung bestehender
Gleisprotokolle, Loc-ID<br>
</p>
<p style="margin-left: 40px;">Der Adressraum hat rund 4
Milliarden verf�gbare Adressen. Von diesem Adressraum wird ein Teil
(Adresse 0 - 65536) f�r die Einbindung bestehender Protokolle
verwendet: In diesem reservierten Bereich werden die bestehenden
Digitalprotokolle eingebettet, repr�sentiert durch die Loc-ID. Durch
Ihre Lage ergibt sich das Protokoll. Aufgef�hrt sind die unteren 2 Byte
der Loc-ID bei diesen Protokollen, die oberen sind = 0x0000.<br>
So ergibt sich folgendes Adressschema:</p>
<table style="margin-left: 40px;" border="1" bordercolor="#000000" cellpadding="3" cellspacing="0">
<tbody>
<tr valign="top">
<td style="background-color: rgb(223, 223, 223);">
<b>Start<br>
Adresse</b> </td>
<td bgcolor="#dfdfdf" width="77">
<b>End<br>
Adresse</b> </td>
<td width="371">
<b>Protokoll</b>
</td>
</tr>
<tr>
<td bgcolor="#dfdfdf" valign="top">
0x0000
</td>
<td bgcolor="#dfdfdf" valign="top">
0x03FF
</td>
<td valign="bottom">
MM1,2 Loks und
Funktionsdecoder <br>
(20 &amp; 40 kHz, 80 &amp; 255 Adressen)
</td>
</tr>
<tr>
<td bgcolor="#dfdfdf" valign="top">
0x0400
</td>
<td bgcolor="#dfdfdf" valign="top">
0x07FF
</td>
<td valign="bottom">
<font style="font-size: 9pt;" size="2"><i>Reserviert</i></font>
</td>
</tr>
<tr>
<td bgcolor="#dfdfdf" valign="top">
0x0800
</td>
<td bgcolor="#dfdfdf" valign="top">
0x0BFF
</td>
<td valign="bottom">
SX1
(Erweiterung)
</td>
</tr>
<tr>
<td bgcolor="#dfdfdf" valign="top">
0x0C00
</td>
<td bgcolor="#dfdfdf" valign="top">
0x0FFF
</td>
<td valign="bottom">
<font style="font-size: 9pt;" size="2"><i>Reserviert</i></font>
</td>
</tr>
<tr>
<td bgcolor="#dfdfdf" valign="top">
0x1000
</td>
<td bgcolor="#dfdfdf" valign="top">
0x13FF
</td>
<td valign="bottom">
<font style="font-size: 9pt;" size="2"><i>Res.
f�r
MM1,2 Funktionsdecoder F1 - F4 (40 kHz, 80 &amp; 255 Adressen)</i></font>
</td>
</tr>
<tr>
<td bgcolor="#dfdfdf" valign="top">
0x1400
</td>
<td bgcolor="#dfdfdf" valign="top">
0x17FF
</td>
<td valign="bottom">
<font style="font-size: 9pt;" size="2"><i>Reserviert
</i></font></td>
</tr>
<tr>
<td bgcolor="#dfdfdf" valign="top">
0x1800
</td>
<td bgcolor="#dfdfdf" valign="top">
0x1BFF
</td>
<td valign="bottom">
Frei f�r
Privatanwender / Clubs
</td>
</tr>
<tr>
<td bgcolor="#dfdfdf" valign="top">
0x1C00
</td>
<td bgcolor="#dfdfdf" valign="top">
0x1FFF
</td>
<td valign="bottom"><font style="font-size: 9pt;" size="2"><i>Reserviert</i></font></td>
</tr>
<tr>
<td bgcolor="#dfdfdf" valign="top">
0x2000
</td>
<td bgcolor="#dfdfdf" valign="top">
0x23FF
</td>
<td valign="bottom">
<font style="font-size: 9pt;" size="2"><i>Reserviert
f�r MM1,2 Lokdecoder (20 kHz, 80 &amp; 256 Adressen)</i></font>
</td>
</tr>
<tr>
<td bgcolor="#dfdfdf" valign="top">
0x2400
</td>
<td bgcolor="#dfdfdf" valign="top">
0x27FF
</td>
<td valign="bottom">
<font style="font-size: 9pt;" size="2"><i>Reserviert</i></font>
</td>
</tr>
<tr>
<td bgcolor="#dfdfdf" valign="top">
0x2800
</td>
<td bgcolor="#dfdfdf" valign="top">
0x2BFF
</td>
<td valign="bottom">
SX1-Zubeh�rartikel
(Erweiterung)
</td>
</tr>
<tr>
<td bgcolor="#dfdfdf" valign="top">
0x2C00
</td>
<td bgcolor="#dfdfdf" valign="top">
0x2FFF
</td>
<td valign="bottom">
<font style="font-size: 9pt;" size="2"><i>Reserviert
f�r Traktionen (interne GUI Kennungen)</i></font>
</td>
</tr>
<tr>
<td bgcolor="#dfdfdf" valign="top">
0x3000
</td>
<td bgcolor="#dfdfdf" valign="top">
0x33FF
</td>
<td valign="bottom">
MM1,2
Zubeh�rartikeldecoder <br>
(40 kHz, 320 &amp; 1024 Adressen)
</td>
</tr>
<tr>
<td bgcolor="#dfdfdf" valign="top">
0x3400
</td>
<td bgcolor="#dfdfdf" valign="top">
0x37FF
</td>
<td valign="bottom">
<font style="font-size: 9pt;" size="2"><i>Reserviert</i></font>
</td>
</tr>
<tr>
<td bgcolor="#dfdfdf" valign="top">
0x3800
</td>
<td bgcolor="#dfdfdf" valign="top">
0x3BFF
</td>
<td valign="bottom">
DCC-Zubeh�rartikel
</td>
</tr>
<tr>
<td bgcolor="#dfdfdf" valign="top">
0x3C00
</td>
<td bgcolor="#dfdfdf" valign="top">
0x3FFF
</td>
<td valign="bottom">
DCC-Zubeh�rartikel
</td>
</tr>
<tr>
<td height="11" valign="top">
<br>
</td>
<td valign="top">
<br>
</td>
<td valign="bottom">
<br>
</td>
</tr>
<tr>
<td valign="top">
0x4000
</td>
<td valign="top">
0x7FFF
</td>
<td valign="bottom">
MFX
</td>
</tr>
<tr>
<td valign="top">
0x8000
</td>
<td valign="top">
0xBFFF
</td>
<td valign="bottom">
SX2
</td>
</tr>
<tr>
<td valign="top">
0xC000
</td>
<td valign="top">
0xFFFF
</td>
<td valign="bottom">
DCC
</td>
</tr>
</tbody>
</table>
<p style="margin-left: 40px;"><br>
Beispiel (Hex):
</p>
<p style="margin-left: 40px;">
M�rklin Motorola mit Adresse 2: Basis: 00
00 00 00 Plus
Adresse: 00 00 00 02<br>
MM2 Zubeh�r mit Adresse 3 Basis: 00 00
30 00 Plus
Adresse: 00 00 30 03</p>
<p style="font-weight: bold;">Zugeordnete Ger�tekennungen
f�r R�ckmelder und Automatikfunktionen</p>
<p style="margin-left: 40px;">Systeme mit einem S88 Bus
oder welche Automatisierungsfunktionen unterst�tzen, werden �ber einen
16Bit Ger�tekenner adressiert.<br>
Die Kontaktkennung und die Automatisierungsfunktion wird somit �ber
eine Kombination von 16 Bit Ger�tekenner und 16Bit
Kontakt/Automatikkennung gebildet. �ber diese Adressierung werden alle
Kontakte und Automatikfunktionen angesprochen.<br>
Die Master - Zentrale weist den Endger�ten die Kennung beim Systemstart
jeweis zu. Eine Resetfeste Speicherung findet in den Ger�ten nicht
statt.<br>
�ber diese Ger�tekennungen wird erreicht, dass eine ausgefallenes Ger�t
im System ersetzt werden kann. Die gespeicherte und verwendete
Adressierung in Automatikfunktionen kann somit unver�ndert �bernommen
werden.<br>
Der Master -Zentrale speichert sich eine Liste mit allen bekannten
Ger�ten im System, sowie deren NickNames als .cs2 Konfigurationsdatei.
Der Name kann sinnvoll vorbelegt werden, muss aber vom Anwender
ge�ndert werden k�nnen.<br>
</p>
<p style="font-weight: bold;">Nummernkreis / Adressen der
R�ckmeldekennungen und Automatikfunktionen<br>
</p>
<p style="margin-left: 40px;">R�ckmeldekennungen beginnen
im Highbyte bei 0 bis maximal 63 Lowbyte im Bereich jeweils von 0 -
255.<br>
Somit maximal 16.384 R�ckmeldekontakte pro Ger�t m�glich.<br>
Der Wert 64 ist reserviert f�r SX1 R�ckmelder.<br>
Automatikfunktionen beginnen im Highbyte bei "A" = 65. Im Lowbyte
beginnen per Konvention zur Zeit die Werte bei "1", dezimal 49 (0x31).<br>
Abildung der Automatikfunktionen wie derzeitiges Memory: A1 = Erste
memory Funktion.<br>
Adresssystematik erm�glicht Ger�te mit R�ckmeldung und
Automatikfunktionen (Wie die CS2).<br>
</p>
<p style="font-weight: bold;">Automatisierungsadressen /
R�ckmeldeadressen<br>
</p>
<p style="margin-left: 40px;">Diese Adressen werden
zusammengesetzt aus der Ger�tekennung (H�her wertig) und der
entsprechenden R�ckmeldekennung bzw Automatikkennung.<br>
</p>
<p style="font-weight: bold;">Geschwindigkeiten:</p>
<p style="margin-left: 40px;">Geschwindigkeiten im
gesamten System werden als 10 - Bit Werte behandelt. Dieser Wert ist
unabh�ngig vom real zur Lok (�ber das Gleis) gesendeten Wert. Der
verwendete Wertebereich sollte von 0 bis 1000 gehen, 0 entspricht einer
stehenden Lok, 1000 der maximalen Geschwindigkeit einer Lok.<br>
Werte oberhalb 1000 (bis 1023)&nbsp; d�rfen vorkommen und sollten
keinen Empf�nger st�ren. Die Fahrgeschwindigkeit entspricht hierbei dem
Maximum.<br>
Die Umrechnung in reale m�glich Fahrstufen ist anhand folgender
Rechenvorschriften m�glich:</p>
<p style="margin-left: 40px;">Systemfahrstufe = 1 +
(Gleisfahrstufe - 1) * Schrittweite<br>
<br>
Fahrstufen<br>
</p>
<table style="margin-left: 43px; width: 298px; height: 172px;" border="1" cellpadding="2" cellspacing="2">
<tbody>
<tr>
<td style="width: 100px;">Anzahl</td>
<td style="width: 151px;"> Schrittweite</td>
</tr>
<tr>
<td style="width: 100px;">14</td>
<td style="width: 151px;"> 77</td>
</tr>
<tr>
<td style="width: 100px;">27</td>
<td style="width: 151px;"> 38</td>
</tr>
<tr>
<td style="width: 100px;">28</td>
<td style="width: 151px;"> 37</td>
</tr>
<tr>
<td style="width: 100px;">31</td>
<td style="width: 151px;"> 33</td>
</tr>
<tr>
<td style="width: 100px;">126</td>
<td style="width: 151px;"> 8</td>
</tr>
</tbody>
</table>
<p style="margin-left: 40px;"><br>
Gleisfahrstufe 1 ist somit immer auch Systemfahrstufe 1.<br>
Gleisfahrstufe 11 ist bei:</p>
<p style="margin-left: 60px; width: 890px;">14 Fahrstufen:
771<br>
27 Fahrstufen: 381<br>
28 Fahrstufen: 371<br>
31 Fahrstufen: 331<br>
126 Fahrstufen: 81<br>
</p>
<table summary="" border="1" cellpadding="3" cellspacing="0" width="100%">
<tbody>
<tr class="TableHeadingColor" bgcolor="#ccccff">
<th colspan="1" align="left"><font size="+2">Sequenzielle Programmierbefehle</font></th>
</tr>
</tbody>
</table>
<p style="margin-left: 40px;">Einige Befehle des Gleis
Format Prozessor sind als
Sonderbefehle / Programmierbefehle realisiert, welche sequenziell
abgearbeitet werden. Nur ein Programmierbefehl kann in Abarbeitung
sein. Um sicherzustellen, dass diese Programmierbefehle auch
abgearbeitet wurden, muss auf die Best�tigung des Gleis Format
Prozessor gewartet werden.<br>
Ein Programmierbefehl wird im Gleis Format Prozessor
zwischengespeichert und zur Abarbeitung �bergeben. Bei Stopp kann diese
Abarbeitung nicht stattfinden, da keine Gleistelegramme gesendet werden
k�nnen. Die Abarbeitung des Programmierbefehl steht in diesem Zustand
aus. Weitere Programmierbefehle werden verworfen.<br>
Einige Programmierbefehle sind nicht auf die Abarbeitung von
Gleistelegrammen angewiesen. Bei diesen kann auch eine Abarbeitung bei
Stopp stattfinden.<br>
Im Einzelnen handelt es sich um folgende Befehle:</p>
<table style="margin-left: 40px;" border="1" bordercolor="#000000" cellpadding="4" cellspacing="0">
<tbody>
<tr valign="top">
<td>Befehl
</td>
<td>Abarbeitung bei Stopp
</td>
</tr>
<tr valign="top">
<td>Lok Discovery
</td>
<td>Nein
</td>
</tr>
<tr valign="top">
<td>MFX Bind
</td>
<td>Nein
</td>
</tr>
<tr valign="top">
<td>MFX Verify
</td>
<td>Nein
</td>
</tr>
<tr valign="top">
<td>Read Config
</td>
<td>Nein
</td>
</tr>
<tr valign="top">
<td>Write Config
</td>
<td>Nein
</td>
</tr>
<tr valign="top">
<td>Read Config Data
</td>
<td>Ja
</td>
</tr>
<tr valign="top">
<td>Statusdaten
Konfiguration
</td>
<td>Ja
</td>
</tr>
</tbody>
</table><b><b><br></p>
</b>
</b>
<table style="width: 100%;" summary="" border="0" cellpadding="1" cellspacing="0">
<tbody>
<tr>
<td colspan="2" class="NavBarCell1" bgcolor="#eeeeff">
<table summary="" border="0" cellpadding="0" cellspacing="3">
<tbody>
<tr align="center" valign="top">
<td class="NavBarCell1" bgcolor="#eeeeff">
<a href="../../overview-summary.html"><font class="NavBarFont1"><b>�bersicht</b></font></a>&nbsp;</td>
<td class="NavBarCell1" bgcolor="#eeeeff">
<a href="../../help-doc.html"><font class="NavBarFont1"><b>Help</b></font></a>&nbsp;</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr>
<td style="background-color: white; text-align: right;" class="NavBarCell2"><font size="-2"> <a href="../../index.html" target="_top"><b>FRAMES</b></a>
&nbsp;
&nbsp;<a href="CAN_Bus.html" target="_top"><b>NO
FRAMES</b></a> &nbsp;
&nbsp;
<script type="text/javascript">
<!--
if(window==top) {
document.writeln('<A HREF="../../allclasses-noframe.html"><B>All Classes</B></A>');
}
//-->
</script>
<noscript> <A
HREF="../../allclasses-noframe.html"><B>All
Classes</B></A>
</noscript>
</font></td>
</tr>
</tbody>
</table>
<b><b><br>
</b>
</b>
<hr>
</body></html>